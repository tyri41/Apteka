<!DOCTYPE html>
<html lang="en">
<head>
    <title>System wyszukujący leki refundowane</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <meta charset="UTF-8">
</head>

<body>
<div class="input-group mb-3" id="box">
    <input type="text" id="Textfield" class="form-control" placeholder="Wyszukaj..." aria-label="Recipient's username" aria-describedby="button-addon2">
    <div class="input-group-append">
      <button class="btn btn-outline-secondary" type="button" onclick="search();">Szukaj</button>
    </div>
  </div>

<script>
    const part = 200;

    const atributes = 9;

    var table;
    var page = 0;

    function redraw() {
        var box = document.getElementById("tables");
        while (box.firstChild)
        {
            box.removeChild(box.firstChild);
        }
        var tbl = document.createElement('table');
        tbl.style.width = '100%';
        tbl.setAttribute('border', '1');
        var tbdy = document.createElement('tbody');
        var labels = document.createElement('tr');
        var etiquettes = ["Nazwa", "Substancja czynna", "Postać", "Dawka", "Zawartość opakowania", "Kod EAN lub inny kod odpowiadający kodowi EAN", "Poziom odpłatności", "Zakres wskazań objętych refundacją", "Wysokość dopłaty świadczeniobiorcy"];
        for (var j = 0; j < atributes; j++) {
            var th = document.createElement('th');
            th.appendChild(document.createTextNode(etiquettes[j]));
            labels.appendChild(th);
        }
        tbl.appendChild(labels);
        for (var i = page * part; i < Math.min((page + 1) * part, table.length); i++) {
            var tr = document.createElement('tr');
            for (var j = 0; j < atributes; j++) {
                if(table[i][j].span > 0){
                    var td = document.createElement('td');
                    td.appendChild(document.createTextNode(table[i][j].value));
                    td.setAttribute('rowSpan', table[i][j].span);
                    tr.appendChild(td);
                }
            }
            tbdy.appendChild(tr);
        }
        tbl.appendChild(tbdy);
        box.appendChild(tbl);
    }

    function search() {
        if(document.getElementById("Textfield").value.length == 0) {
            alert("Pusta fraza wyszukiwania");
            return;
        }
        $.getJSON(window.location.href + "find?q=" + document.getElementById("Textfield").value, function(t) {
            table = t;
            page = 0;
            for(var j = 0; j < atributes; j++) {
                for(var i = 0; i < table.length; i++) {
                    if(i % part == 0) {
                        var x = i;
                        while(table[x][j].span == 0)
                            x--;
                        if(x != i) {
                            table[i][j].span = table[x][j].span - (i - x);
                            table[x][j].span = i - x;
                        }
                    }
                }
            }
            redraw();
        });
    }

    function down() {
        if(page > 0)
            page--;
        redraw();
    }

    function up() {
        if(page < Math.ceil(table.length / part) - 1)
            page++;
        redraw();
    }

    function scroll(btn) {
        page = parseInt(btn.innerHTML);
        redraw();
    }
</script>
<div id="tables" style='padding: 5px;'><b>Na razie brak wyników</b></div>
<footer> 
    <div class="btn-group" role="group" aria-label="Basic example">
        <button type="button" class="btn btn-secondary" onclick="down();">&larr;</button>
        <button type="button" class="btn btn-secondary" onclick="up();">&rarr;</button>
      </div>
</footer>
</body>
</html>